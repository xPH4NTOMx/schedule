<!DOCTYPE html>
<html>
<head>
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - IT Lampang</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { color: #333; text-align: center; }
        .btn-add { background: #28a745; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; margin-bottom: 20px; border: none; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #6f42c1; color: white; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; color: white; }
        .role-admin { background: #dc3545; }
        .role-teacher { background: #17a2b8; }
        .role-student { background: #007bff; }
        .role-other { background: #6c757d; }
        .btn-edit { background: #ffc107; color: #000; padding: 5px 10px; border-radius: 5px; text-decoration: none; margin-right: 5px; border: none; cursor: pointer; }
        .btn-delete { background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; text-decoration: none; border: none; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 10% auto; padding: 30px; border-radius: 15px; width: 400px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: 'Sarabun'; }
        .modal-footer { text-align: right; margin-top: 20px; }
        .btn-save { background: #6f42c1; color: white; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; width: 100%; font-size: 1rem; }
        .btn-cancel { background: #eee; color: #333; padding: 8px 15px; border-radius: 8px; border: none; cursor: pointer; margin-right: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <button class="btn-add" onclick="openAddModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
        <a href="/dashboard" style="text-decoration: none; color: #666;">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
    </div>

    <table>
        <thead>
            <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                <th>Username</th>
                <th>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                <th>‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody>
            <% users.forEach(user => { %>
                <tr>
                    <td><%= user.fullname %></td>
                    <td><%= user.username %></td>
                    <td>
                        <span class="badge <%= user.role === 'admin' ? 'role-admin' : user.role === 'teacher' ? 'role-teacher' : user.role === 'student' ? 'role-student' : 'role-other' %>">
                            <%= user.role %>
                        </span>
                    </td>
                    <td><%= user.groupId || '-' %></td>
                    <td>
                        <button class="btn-edit" onclick="openEditModal('<%= user.id %>', '<%= user.fullname %>', '<%= user.username %>', '<%= user.role %>', '<%= user.groupId %>')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <a href="/admin/delete-user/<%= user.id %>" class="btn-delete" onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ?')">‡∏•‡∏ö</a>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>
</div>

<div id="userModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
        <form id="userForm" method="POST" action="/admin/add-user">
            <input type="hidden" name="userId" id="userId">
            
            <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                <input type="text" name="fullname" id="fullname" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label>Username</label>
                <input type="text" name="username" id="username" class="form-control" required>
            </div>
            
            <div class="form-group">
                <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
                <input type="password" name="password" id="password" class="form-control">
            </div>

            <div class="form-group">
                <label>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Role)</label>
                <select name="role" id="role" class="form-control" required onchange="toggleGroupSelect()">
                    <option value="student">student</option>
                    <option value="teacher">teacher</option>
                    <option value="scheduler">scheduler</option>
                    <option value="admin">admin</option>
                    <option value="program_manager">program_manager</option>
                </select>
            </div>

            <div class="form-group" id="groupSection">
                <label>‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</label>
                <select name="groupId" id="groupId" class="form-control">
                    <option value="">-- ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏•‡∏∏‡πà‡∏° --</option>
                    <% groups.forEach(group => { %>
                        <option value="<%= group.group_id %>"><%= group.group_id %></option>
                    <% }) %>
                </select>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button type="submit" class="btn-save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </form>
    </div>
</div>

<script>
    const modal = document.getElementById('userModal');
    const form = document.getElementById('userForm');

    function openAddModal() {
        document.getElementById('modalTitle').innerText = "‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà";
        form.action = "/admin/add-user";
        form.reset();
        document.getElementById('userId').value = "";
        document.getElementById('password').required = true;
        modal.style.display = "block";
        toggleGroupSelect();
    }

    function openEditModal(id, fullname, username, role, groupId) {
        document.getElementById('modalTitle').innerText = "üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        form.action = "/admin/edit-user";
        document.getElementById('userId').value = id;
        document.getElementById('fullname').value = fullname;
        document.getElementById('username').value = username;
        document.getElementById('role').value = role;
        document.getElementById('groupId').value = groupId || "";
        document.getElementById('password').required = false; // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        modal.style.display = "block";
        toggleGroupSelect();
    }

    function closeModal() {
        modal.style.display = "none";
    }

    function toggleGroupSelect() {
        const role = document.getElementById('role').value;
        const groupSection = document.getElementById('groupSection');
        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô student ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        groupSection.style.display = (role === 'student') ? 'block' : 'none';
    }

    // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å
    window.onclick = function(event) {
        if (event.target == modal) closeModal();
    }
</script>

</body>
</html>